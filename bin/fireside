#!/usr/bin/env python3

import argparse
from fireside import Fireside, FiresideWeb

parser = argparse.ArgumentParser(description="Fireside App")
subparsers = parser.add_subparsers(dest="subcommand")

################################################################################
## Fireside web
################################################################################

web_parser = subparsers.add_parser(
    "web", description="Fireside Web"
)
web_parser.add_argument("-host", help="ip address of fireside webserver", default="0.0.0.0", type=str)
web_parser.add_argument("-port", help="port of fireside webserver", default="8080", type=str)

################################################################################
## Fireside terminal
################################################################################

parser.add_argument(
    "-pub",
    metavar="pub-address",
    type=str,
    default="",
    help="Address for publish notification",
)

parser.add_argument(
    "-sub",
    metavar="sub-address",
    type=str,
    default="",
    help="Address for subscribe notification",
)

parser.add_argument(
    "-username",
    metavar="username",
    type=str,
    default="",
    help="username in fireside app",
)

args = parser.parse_args()

################################################################################
## Run
################################################################################

# web
if args.subcommand == "web":
    FiresideWeb(host=args.host, port=args.port)

# terminal
else:
    if args.pub and args.sub:
        Fireside(name=args.username, pub_address=args.pub, sub_address=args.sub).main()
    else:
        Fireside(
            name=args.username,
            pub_address="tcp://0.0.0.0:5000",
            sub_address="tcp://0.0.0.0:5001",
            mode="master",
        ).main()
